chrome.runtime.onInstalled.addListener(()=>{chrome.sidePanel.setPanelBehavior({openPanelOnActionClick:!0}).catch(()=>{})});chrome.runtime.onMessage.addListener((r,s,e)=>{if(r?.type==="EXECUTE_ACTION")return(async()=>{try{const t=r.action;if(t?.type==="navigate"){const[i]=await chrome.tabs.query({active:!0,currentWindow:!0});if(!i?.id)throw new Error("No active tab");await chrome.tabs.update(i.id,{url:t.url}),await new Promise(n=>{const o=(u,d)=>{u===i.id&&d.status==="complete"&&(chrome.tabs.onUpdated.removeListener(o),n())};chrome.tabs.onUpdated.addListener(o),setTimeout(()=>{chrome.tabs.onUpdated.removeListener(o),n()},15e3)}),e({ok:!0,result:{navigated:t.url}});return}const[a]=await chrome.tabs.query({active:!0,currentWindow:!0});if(!a?.id)throw new Error("No active tab");const c=await chrome.tabs.sendMessage(a.id,r);e(c)}catch(t){e({ok:!1,error:String(t)})}})(),!0;if(r?.type==="GET_PAGE_CONTEXT")return(async()=>{try{const[t]=await chrome.tabs.query({active:!0,currentWindow:!0});if(!t?.id)throw new Error("No active tab");const a=await chrome.tabs.sendMessage(t.id,{type:"GET_PAGE_CONTEXT"});e(a)}catch(t){e({ok:!1,error:String(t)})}})(),!0});
